<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="utf-8" />
  <title>Apple → Spotify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ---- Base ---- */
    :root {
      --bg: #000;
      --panel: rgba(24,24,24,0.9);
      --border: #333;
      --text: #fff;
      --muted: #d7d7d7;
      --accent: #1db954; /* Spotify green */
      --accent-2: #1ed760;
      --shadow: 0 0 30px rgba(0,0,0,0.7);
      --brand: #500000; /* maroon accent for tabs */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      display: grid;
      grid-template-rows: auto 1fr;
      overflow-x: hidden;
    }

    /* ---- Animated Background (Canvas) ---- */
    #bg {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: -2;
      background: radial-gradient(1200px 800px at 70% 20%, rgba(30,30,30,0.5), transparent 60%),
                  radial-gradient(900px 600px at 20% 80%, rgba(25,25,25,0.6), transparent 65%),
                  #000;
    }

    /* subtle vignette */
    .vignette {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -1;
      background: radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.6) 100%);
    }

    /* ---- Top Hero Heading ---- */
    header {
      width: 100%;
      padding: clamp(18px, 3vw, 28px) clamp(20px, 4vw, 40px);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hero-title {
      font-size: clamp(1.6rem, 5vw, 3rem);
      font-weight: 800;
      letter-spacing: 0.02em;
      text-align: center;
      line-height: 1.15;
      margin: 0;
      text-shadow: 0 0 18px rgba(29,185,84,0.15);
    }

    /* ---- Main Content ---- */
    main {
      display: grid;
      place-items: center;
      padding: 32px 16px 64px;
      gap: 16px;
    }

    .box {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: clamp(20px, 5vw, 36px) clamp(20px, 5vw, 40px);
      max-width: 720px;
      width: min(92vw, 720px);
      text-align: center;
      box-shadow: var(--shadow);
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
    }

    .box h1 {
      font-size: clamp(1.4rem, 4.5vw, 2.2rem);
      margin: 0 0 10px;
      font-weight: 800;
    }
    .box p {
      margin: 0;
      font-size: clamp(1rem, 2.6vw, 1.12rem);
      line-height: 1.6;
      color: var(--muted);
    }

    /* ---- Button (anchor or button element) ---- */
    a.btn, button.btn {
      display: inline-block;
      margin-top: 1.2rem;
      padding: 0.95rem 1.5rem;
      border: none;
      border-radius: 12px;
      text-decoration: none;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      font-size: 1rem;
      transition: transform 0.18s ease, background 0.18s ease, box-shadow 0.18s ease;
      box-shadow: 0 10px 25px rgba(29,185,84,0.25);
      cursor: pointer;
    }
    a.btn:hover, button.btn:hover { background: var(--accent-2); transform: translateY(-1px) scale(1.03); }
    a.btn:active, button.btn:active { transform: translateY(0); }

    /* ---- Animations ---- */
    .fade-in {
      opacity: 0;
      transform: translateY(16px);
      animation: fadeInUp 0.9s forwards ease-out;
    }
    .delay-1 { animation-delay: 0.6s; }
    .delay-2 { animation-delay: 1.2s; }

    @keyframes fadeInUp {
      to { opacity: 1; transform: translateY(0); }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .fade-in { animation: none; opacity: 1; transform: none; }
    }

    /* Small screens */
    @media (max-width: 420px) {
      .box { border-radius: 14px; }
    }

    /* ---------- Modal styles ---------- */
    .hidden { display: none; }
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.6);
      display: flex; align-items: center; justify-content: center;
      z-index: 50;
      padding: 16px;
    }
    .modal-card {
      background: #111;
      color: #fff;
      border: 1px solid #2a2a2a;
      border-radius: 14px;
      width: min(92vw, 420px);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .tabs { display: flex; gap: .5rem; margin-bottom: .75rem; }
    .tab {
      flex: 1; padding: .5rem; border: 1px solid #333; border-radius: 10px;
      background: #191919; color: #fff; cursor: pointer; font-weight: 700;
    }
    .tab.active { background: #141414; border-color: var(--brand); }
    .tab-panel.hidden { display: none; }
    .form-row { display: grid; gap: 6px; margin: 8px 0; }
    .form-row input {
      background: #0e0e0e; color: #fff; border: 1px solid #2a2a2a;
      border-radius: 10px; padding: 10px 12px; width: 100%;
    }
    .form-errors { color: #ff6b6b; min-height: 1rem; margin-top: .5rem; font-size: .95rem; }
    .link { background: none; border: none; color: var(--brand); cursor: pointer; margin-top: .5rem; }
  </style>
</head>
<body>
  <!-- Animated background -->
  <canvas id="bg" aria-hidden="true"></canvas>
  <div class="vignette" aria-hidden="true"></div>

  <header>
    <h2 class="hero-title">The best place to transfer your music</h2>
  </header>

  <main>
    <!-- First intro box -->
    <section class="box fade-in delay-1" aria-label="Intro">
      <h1>Transfer your Apple playlist to a Spotify playlist</h1>
      <p>
        Bring your favorite Apple Music playlists to Spotify in just a few clicks.
        We match your tracks with high accuracy so your vibe follows you — fast, simple, and free.
      </p>
    </section>

    <!-- Upload call-to-action box -->
    <section class="box fade-in delay-2" aria-label="Upload">
      <p>Ready to go? Click below to upload your Apple Music playlist file and start transferring.</p>
      <!-- Trigger modal/status flow instead of linking directly -->
      <button id="uploadBtn" class="btn">Upload a Playlist</button>
    </section>
  </main>

  <!-- ---------- Auth Modal ---------- -->
  <div id="authModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="modal-card">
      <div class="tabs">
        <button data-tab="login"  class="tab active" aria-controls="loginForm" aria-selected="true">Log in</button>
        <button data-tab="signup" class="tab" aria-controls="signupForm" aria-selected="false">Sign up</button>
      </div>

      <!-- LOGIN -->
      <form id="loginForm" class="tab-panel" data-action="{% url 'login_api' %}">
        {% csrf_token %}
        <div class="form-row">
          <label for="loginEmail">Email</label>
          <input id="loginEmail" type="email" name="email" required autocomplete="email">
        </div>
        <div class="form-row">
          <label for="loginPass">Password</label>
          <input id="loginPass" type="password" name="password" required autocomplete="current-password">
        </div>
        <button type="submit" class="btn" style="width:100%;">Log in</button>
        <div class="form-errors" data-for="login"></div>
      </form>

      <!-- SIGNUP -->
      <form id="signupForm" class="tab-panel hidden" data-action="{% url 'signup_api' %}">
        {% csrf_token %}
        <div class="form-row">
          <label for="suEmail">Email (must match your Spotify email)</label>
          <input id="suEmail" type="email" name="email" required autocomplete="email">
        </div>
        <div class="form-row">
          <label for="suSpotifyEmail">Spotify Email</label>
          <input id="suSpotifyEmail" type="email" name="spotify_email" required autocomplete="email">
        </div>
        <div class="form-row">
          <label for="suPass">Password</label>
          <input id="suPass" type="password" name="password" required minlength="8" autocomplete="new-password">
        </div>
        <div class="form-row">
          <label for="suPass2">Confirm Password</label>
          <input id="suPass2" type="password" name="confirm_password" required minlength="8" autocomplete="new-password">
        </div>
        <button type="submit" class="btn" style="width:100%;">Create account</button>
        <div class="form-errors" data-for="signup"></div>
      </form>

      <button id="closeAuth" class="link" type="button">Cancel</button>
    </div>
  </div>

  <!-- ---------- Pending Modal ---------- -->
  <div id="pendingModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="pendingTitle">
    <div class="modal-card">
      <h3 id="pendingTitle" style="margin:0 0 8px;">Authenticating your account…</h3>
      <p style="color:#d7d7d7;margin:0 0 12px;">This usually takes a few minutes. We’ll email you once you’re approved.</p>
      <button id="pendingClose" class="btn" type="button" style="width:100%;">OK</button>
    </div>
  </div>

  <!-- Starfield -->
  <script>
    // ====== Starfield + connecting lines (lightweight) ======
    (function () {
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const canvas = document.getElementById('bg');
      const ctx = canvas.getContext('2d');

      let w, h, dpr, particles, running = !prefersReduced;
      const MAX_PARTICLES = 120; // auto-scaled below
      const LINK_DIST = 110;     // px
      const SPEED = 0.08;        // px per ms

      function resize() {
        dpr = Math.min(window.devicePixelRatio || 1, 2);
        w = canvas.width = Math.floor(window.innerWidth * dpr);
        h = canvas.height = Math.floor(window.innerHeight * dpr);
        canvas.style.width = window.innerWidth + 'px';
        canvas.style.height = window.innerHeight + 'px';
        initParticles();
      }

      function initParticles() {
        const count = Math.min(MAX_PARTICLES, Math.round((window.innerWidth * window.innerHeight) / 14000));
        particles = [];
        for (let i = 0; i < count; i++) {
          particles.push({
            x: Math.random() * w,
            y: Math.random() * h,
            vx: (Math.random() * 2 - 1) * SPEED * dpr,
            vy: (Math.random() * 2 - 1) * SPEED * dpr,
            r: (Math.random() * 1.6 + 0.6) * dpr,
            twinkle: Math.random() * Math.PI * 2
          });
        }
      }

      let last = performance.now();
      function frame(now) {
        if (!running) return;
        const dt = Math.min(now - last, 50);
        last = now;

        ctx.clearRect(0, 0, w, h);

        // Draw links
        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        for (let i = 0; i < particles.length; i++) {
          const a = particles[i];
          for (let j = i + 1; j < particles.length; j++) {
            const b = particles[j];
            const dx = a.x - b.x;
            const dy = a.y - b.y;
            const dist = Math.hypot(dx, dy);
            if (dist < LINK_DIST * dpr) {
              const alpha = 0.08 * (1 - dist / (LINK_DIST * dpr));
              ctx.strokeStyle = `rgba(180, 180, 180, ${alpha})`;
              ctx.lineWidth = dpr * 0.6;
              ctx.beginPath();
              ctx.moveTo(a.x, a.y);
              ctx.lineTo(b.x, b.y);
              ctx.stroke();
            }
          }
        }
        ctx.restore();

        // Draw stars
        for (const p of particles) {
          p.x += p.vx * dt;
          p.y += p.vy * dt;

          // wrap around edges
          if (p.x < -20) p.x = w + 20;
          if (p.x > w + 20) p.x = -20;
          if (p.y < -20) p.y = h + 20;
          if (p.y > h + 20) p.y = -20;

          // twinkle
          p.twinkle += dt * 0.003;
          const glow = 0.2 + Math.sin(p.twinkle) * 0.4;

          // star glow
          const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 4);
          grad.addColorStop(0, `rgba(255,255,255,${0.6 * glow})`);
          grad.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.fillStyle = grad;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r * 4, 0, Math.PI * 2);
          ctx.fill();

          // core
          ctx.fillStyle = `rgba(255,255,255,${0.95 * glow})`;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        }

        requestAnimationFrame(frame);
      }

      // Pause animation when tab hidden (saves battery)
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          running = false;
        } else if (!prefersReduced) {
          running = true;
          last = performance.now();
          requestAnimationFrame(frame);
        }
      });

      // Setup
      window.addEventListener('resize', resize, { passive: true });
      resize();

      if (!prefersReduced) {
        requestAnimationFrame(frame);
      } else {
        // If reduced motion, paint a single static starfield
        for (let i = 0; i < (particles?.length || 80); i++) {
          const x = Math.random() * w, y = Math.random() * h;
          const r = (Math.random() * 1.6 + 0.6) * dpr;
          ctx.fillStyle = 'rgba(255,255,255,0.9)';
          ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2); ctx.fill();
        }
      }
    })();
  </script>

  <!-- Auth modal JS (handles /auth/status, login, signup, pending modal) -->
  <script src="{% static 'core/js/auth_modal.js' %}"></script>
</body>
</html>
